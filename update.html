<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>현황 알리기</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="update-page">
  <!-- 배경 장식 블롭 -->
  <div class="blob blob1"></div>
  <div class="blob blob2"></div>
  <div class="blob blob3"></div>

  <!-- 콘텐츠 래퍼 -->
  <div class="wrapper">
    <!-- 동적으로 그룹 이름이 들어갑니다 -->
    <h1 id="title">현황 알리기</h1>

    <!-- 상태 업데이트 버튼들 -->
    <div id="buttons">
      <button data-status="시작">🚀 시작</button>
      <button data-status="토의중">🤔 토의중</button>
      <button data-status="작업중">✍️ 작업중</button>
      <button data-status="도움 요청">🙋‍♂️ 도움 요청!</button>
      <button data-status="완료">🎉 완료</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- 업데이트 로직 -->
  <script>
    // 1) Firebase 설정 (Firebase 콘솔에서 복사 후 붙여넣기)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('currentActivity');

    // 2) URL에서 'group' 파라미터 추출 및 검증
    const params = new URLSearchParams(location.search);
    const group = params.get('group');
    if (!group) {
      alert('잘못된 접근입니다. 대시보드에서 QR코드를 스캔해 주세요.');
      throw new Error('Missing group parameter');
    }
    document.getElementById('title').textContent = `${group} 현황 알리기`;

    // 3) 버튼 클릭 시 실시간 상태 업데이트
    document.querySelectorAll('#buttons button').forEach(btn => {
      btn.addEventListener('click', () => {
        const status = btn.getAttribute('data-status');
        console.log('🔘 클릭!', group, status);
        db.child(group).update({ status, lastUpdate: new Date().toISOString() })
          .then(() => console.log('✅ Firebase 업데이트 성공'))
          .catch(err => console.error('❌ Firebase 업데이트 실패', err));
      });
    });
  </script>
</body>
</html>
